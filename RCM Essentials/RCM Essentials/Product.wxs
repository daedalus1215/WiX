<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

  <!-- This will be root directory for PHP/Apache and the essential variableEnv -->
  <Product Id="*"
           Name="Recovery Case Manager Essentials"
           Language="1033"
           Version="1.0.0.0"
           Manufacturer="iAutomate"
           UpgradeCode="ce7d3464-2bf9-48a0-8118-d3f72b2412ec">


    <Package InstallerVersion="301"
              Compressed="yes"
              InstallScope="perMachine" />

    <!-- Insure we embed cab files inside the MSI. -->
    <MediaTemplate EmbedCab="yes"/>

    <MajorUpgrade
      DowngradeErrorMessage="A newer version of [ProductName] is already installed." />

    <!-- Step 1: Define the directory structure -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ApplicationRootDirectory" Name="Iag">
        <Directory Id="ApplicationApacheDirectory" Name="apache" />
        <Directory Id="ApplicationPhpDirectory" Name="php"/>
      </Directory>
    </Directory>


    <!-- Kill old PHP env variable and Set a new one.-->
    <Component Id="phpEnvVar" Guid="{A404A63E-5A4A-477E-959B-C8086B4425DE}" Directory="ApplicationRootDirectory">
      <CreateFolder/>
      <Environment Id="removePHP" Name="PATH" Value="C:\php" Permanent="no" Part="last" Action="remove" System="yes" />
      <Environment Id="InsertPHP" Name="IAG" Value="C:\Iag\php" Permanent="no" Part="last" Action="set" System="yes" />
    </Component>

    <!-- Kill old Apache env variable and set a new one -->
    <Component Id="apacheEnvVar" Guid="{BEF5671B-C00B-46F3-8850-5BDD7461233D}" Directory="ApplicationRootDirectory">
      <CreateFolder/>
      <Environment Id="removeApache" Name="PATH" Value="C:\apache\bin" Permanent="no" Part="last" Action="remove" System="yes" />
      <Environment Id="InsertApache" Name="IAG" Value="C:\iag\apache\bin" Permanent="no" Part="last" Action="remove" System="yes" />
    </Component>
    
    
    
    <!-- Step 3: Tell WiX to install the files -->
    <Feature Id="MainApplication" Title="Main Application" Level="1">
      <ComponentGroupRef Id="PhpFilesGroup" />
      <ComponentRef Id="phpEnvVar" />
      <ComponentGroupRef Id="ApacheFilesGroup"/>
      <ComponentRef Id="apacheEnvVar"/>
    </Feature>


  </Product>

</Wix>

