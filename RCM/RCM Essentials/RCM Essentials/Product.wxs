<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

  <!-- This will be root directory for PHP/Apache and the essential variableEnv -->
  <Product Id="*"
           Name="Recovery Case Manager Essentials"
           Language="1033"
           Version="1.0.0.0"
           Manufacturer="iAutomate"
           UpgradeCode="ce7d3464-2bf9-48a0-8118-d3f72b2412ec">

    

    <Package  InstallerVersion="301"
              Compressed="yes"
              InstallScope="perMachine" 
              InstallPrivileges="elevated"/>

    
    
    <!-- Insure we embed cab files inside the MSI. -->
    <MediaTemplate EmbedCab="yes"/>

    
    
    <MajorUpgrade
      DowngradeErrorMessage="A newer version of [ProductName] is already installed." />

    
    
    <!-- Step 1: Define the directory structure -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ApplicationRootDirectory" Name="Iag">
        <Directory Id="ApplicationApacheDirectory" Name="apache" />
        <Directory Id="ApplicationPhpDirectory" Name="php"/>
        <Directory Id="ApplicationInstantClientDirectory" Name="instantclient_12_1"/>
      </Directory>
    </Directory>

    

    <!-- Kill old PHP env variable and Set a new one.-->
    <Component Id="phpEnvVar" Guid="{A404A63E-5A4A-477E-959B-C8086B4425DE}" Directory="ApplicationRootDirectory">
      <CreateFolder/>
      <Environment Id="removePHP" Name="PATH" Value="C:\php" Permanent="no" Part="last" Action="remove" System="yes" />
      <Environment Id="InsertPHP" Name="IAG" Value="C:\Iag\php" Permanent="no" Part="last" Action="set" System="yes" />
    </Component>

    <!-- Kill old Apache env variable and set a new one -->
    <Component Id="apacheEnvVar" Guid="{BEF5671B-C00B-46F3-8850-5BDD7461233D}" Directory="ApplicationRootDirectory">
      <CreateFolder/>
      <Environment Id="removeApache" Name="PATH" Value="C:\iag\apache\bin" Permanent="no" Part="last" Action="remove" System="yes" />
      <Environment Id="InsertApache" Name="IAG" Value="C:\iag\apache\bin" Permanent="no" Part="last" Action="set" System="yes" />
    </Component>
  
    <!-- Kill old Oracle Instant Client env variable and set a new one -->
    <Component Id="OracleInstantClientEnvVar" Guid="{91A777F2-DF3C-4F22-9538-7BFFCAF5BB3A}" Directory="ApplicationRootDirectory">
      <CreateFolder/>
      <Environment Id="removeOracleInstantClient" Name="PATH" Value="C:\instantclient_11_2" Permanent="no" Part="last" Action="remove" System="yes" />
      <Environment Id="addOracleInstantClient"    Name="IAG" Value="C:\iag\instantclient_12_1" Permanent="no" Part="last" Action="set" System="yes" />
    </Component>


    <!-- Kill old Imagick env variable, no need to set it, because installer should. -->
    <Component Id="imagickEnvVar" Guid="{41692758-F562-4861-9508-CA52FC7D7611}" Directory="ApplicationRootDirectory">
      <CreateFolder/>
      <Environment Id="removeImagick" Name="PATH" Value="C:\iag\utility\ImageMagick" Permanent="no" Part="last" Action="remove" System="yes"/>
    </Component>
  

    
    
    
    <!-- Step 3: Tell WiX to install the files -->
    <Feature Id="MainApplication" Title="Main Application" Level="1">
      
      <ComponentGroupRef Id="PhpFilesGroup" />
      <ComponentRef Id="phpEnvVar" />
      
      <ComponentGroupRef Id="ApacheFilesGroup"/>
      <ComponentRef Id="apacheEnvVar"/>

      <ComponentGroupRef Id="InstantClientFilesGroup"/>
      <ComponentRef Id="OracleInstantClientEnvVar"/>

      <ComponentRef Id="imagickEnvVar"/>

    </Feature>


    
  </Product>
</Wix>

